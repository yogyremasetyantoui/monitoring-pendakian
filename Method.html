<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metodologi Penelitian - Sistem Monitoring Pendaki Gunung Gede Pangrango</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/panzoom/9.4.3/panzoom.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            line-height: 1.6;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 2px solid #e9ecef;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-zoom-in {
            background: #4CAF50;
            color: white;
        }

        .btn-zoom-out {
            background: #2196F3;
            color: white;
        }

        .btn-reset {
            background: #FF9800;
            color: white;
        }

        .btn-fullscreen {
            background: #9C27B0;
            color: white;
        }

        .info-text {
            color: #666;
            font-size: 0.95em;
            font-style: italic;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 300px);
            min-height: 600px;
            overflow: hidden;
            background: #fafafa;
            cursor: grab;
            touch-action: none;
        }

        .chart-container:active {
            cursor: grabbing;
        }

        #flowchart-wrapper {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        #flowchart {
            display: inline-block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        #flowchart svg {
            max-width: none !important;
            height: auto !important;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: #667eea;
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .footer p {
            margin: 10px 0;
            opacity: 0.9;
        }

        .footer a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .legend {
            background: white;
            padding: 20px;
            margin: 20px 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .legend h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid #ddd;
        }

        .legend-label {
            font-size: 0.95em;
            color: #333;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 1em;
            }

            .controls {
                padding: 15px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }

            .chart-container {
                height: calc(100vh - 400px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèîÔ∏è Metodologi Penelitian</h1>
            <p>Sistem Monitoring Real-Time Pendaki Gunung dengan Anomaly Detection</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Studi Kasus: Gunung Gede Pangrango</p>
        </div>

        <div class="legend">
            <h3>üìä Kategori Tahapan Penelitian</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <div class="legend-label">Start & End</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <div class="legend-label">Persiapan</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF9800;"></div>
                    <div class="legend-label">Pengumpulan Data</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9C27B0;"></div>
                    <div class="legend-label">Modeling</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #E91E63;"></div>
                    <div class="legend-label">Sistem & Testing</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #00BCD4;"></div>
                    <div class="legend-label">Analisis</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFC107;"></div>
                    <div class="legend-label">Dokumentasi</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-zoom-in" onclick="zoomIn()">
                üîç Zoom In
            </button>
            <button class="btn btn-zoom-out" onclick="zoomOut()">
                üîé Zoom Out
            </button>
            <button class="btn btn-reset" onclick="resetZoom()">
                üîÑ Reset View
            </button>
            <button class="btn btn-fullscreen" onclick="toggleFullscreen()">
                ‚õ∂ Fullscreen
            </button>
            <span class="info-text">üí° Klik & drag untuk menggeser, scroll untuk zoom</span>
        </div>

        <div class="chart-container" id="chart-container">
            <div class="loading">‚è≥ Loading flowchart...</div>
            <div id="flowchart-wrapper">
                <div id="flowchart">
                    <pre class="mermaid">
flowchart TD
    Start([üöÄ Mulai Penelitian]) --> A[üìö Studi Literatur & Kerangka Teoritis]
    
    A --> B{Persiapan Penelitian}
    B --> B1[‚úÖ Ethical Clearance & Izin]
    B --> B2[üë• Rekrutmen 3 Volunteer]
    B --> B3[üîß Setup Infrastruktur]
    
    B3 --> B3a[Barcode Scanner 8 Pos]
    B3 --> B3b[Starlink Mini 4 Pos]
    B3 --> B3c[Server Cloud Database]
    
    B1 & B2 & B3a & B3b & B3c --> C{Pengumpulan Data}
    
    C --> C1[üìä Data Primer]
    C --> C2[üìÅ Data Sekunder]
    C --> C3[üó∫Ô∏è Data Geospasial]
    
    C1 --> C1a[V1: 07:00<br/>Experienced]
    C1 --> C1b[V2: 08:00<br/>Intermediate]
    C1 --> C1c[V3: 09:00<br/>Beginner]
    
    C2 --> C2a[Strava GPS<br/>Tracks Global]
    C2 --> C2b[Literature Review:<br/>Weather & Fatigue Models]
    C2 --> C2c[Historical Incidents:<br/>Gede Pangrango 2006-2025]
    
    C3 --> C3a[DEM High<br/>Resolution]
    C3 --> C3b[GPS Track<br/>5m Vertex]
    C3 --> C3c[Simplified<br/>10m, 20m, 50m]
    
    C1a & C1b & C1c --> D[üìù Data Recording per Segment]
    
    D --> D1[üåÑ Spatial:<br/>Slope, Elevasi, Jarak]
    D --> D2[‚è±Ô∏è Temporal:<br/>Timestamp]
    D --> D3[üå§Ô∏è Environmental:<br/>Weather]
    D --> D4[üë§ Individual:<br/>Cumulative Gain]
    D --> D5[ü•æ Trail Condition:<br/>Tanah, Lumpur, Bebatuan]
    
    C2a & C2b & C2c & C3a & C3b & C3c --> E[üîÑ Integrasi & Preprocessing Data]
    D1 & D2 & D3 & D4 & D5 --> E
    
    E --> G{üî¨ Pengembangan Model}
    
    G --> G1[Model 1:<br/>Topografi-Kecepatan]
    G --> G2[Model 2:<br/>Cumulative Fatigue]
    G --> G3[Model 3:<br/>Weather Impact]
    G --> G4[Model 4:<br/>Trail Condition]
    G --> G5[Model 5:<br/>Individual Calibration]
    G --> G6[Model 6:<br/>Cartographic Resolution]
    
    G1 & G2 & G3 & G4 & G5 & G6 --> H[üéØ Integrasi Model Bayesian]
    
    H --> I[‚ö° Model Prediktif Terintegrasi]
    I --> I1[v_predicted = v_base √ó f_fatigue<br/>√ó f_weather √ó f_trail √ó cal_factor]
    
    I1 --> J{üìê Analisis Generalisasi}
    
    J --> J1[Bias Jarak<br/>per Resolusi]
    J --> J2[Bias Slope<br/>per Resolusi]
    J --> J3[Dampak Akurasi<br/>Prediksi]
    
    J1 & J2 & J3 --> K{üíª Pengembangan Sistem Prototype}
    
    K --> K1[üì± Barcode Check-in<br/>7 Status QR]
    K --> K2[‚ö†Ô∏è Real-Time<br/>Anomaly Detection]
    K --> K3[üì° Starlink<br/>Communication]
    K --> K4[üñ•Ô∏è SAR Dashboard<br/>Mobile App]
    
    K1 & K2 & K3 & K4 --> L{üß™ Testing & Validasi}
    
    L --> L1[‚úì Akurasi Prediksi<br/>MAE 15-25 min]
    L --> L2[‚úì Sensitivity &<br/>Specificity]
    L --> L3[‚úì Time-to-Contact<br/>< 5 menit]
    L --> L4[‚úì Usability Testing<br/>Expert Interviews]
    
    L1 & L2 & L3 & L4 --> M[üìä Analisis Hasil]
    
    M --> M1[Regression Analysis]
    M --> M2[Bayesian Inference]
    M --> M3[ROC Curve]
    M --> M4[Confusion Matrix]
    
    M1 & M2 & M3 & M4 --> N{üí° Pembahasan}
    
    N --> N1[Validasi Hipotesis<br/>H1-H5]
    N --> N2[Interpretasi<br/>Time Geography]
    N --> N3[Perbandingan<br/>Literatur]
    N --> N4[Limitasi &<br/>Generalisasi]
    
    N1 & N2 & N3 & N4 --> O{üìù Dokumentasi & Deliverables}
    
    O --> O1[üìã SOP]
    O --> O2[üéì Training<br/>Materials SAR]
    O --> O3[üìñ Implementation<br/>Guidelines]
    O --> O4[üìÑ Research Articles<br/>2-3 Papers]
    
    O1 & O2 & O3 & O4 --> P{üéØ Kesimpulan & Rekomendasi}
    
    P --> P1[üèõÔ∏è Blueprint<br/>Sistem Nasional]
    P --> P2[‚öñÔ∏è Rekomendasi<br/>Kebijakan]
    P --> P3[üî¨ Saran Penelitian<br/>Lanjutan]
    
    P1 & P2 & P3 --> End([‚ú® Selesai])
    
    classDef startEnd fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    classDef preparation fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    classDef dataCollection fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    classDef modeling fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    classDef system fill:#E91E63,stroke:#AD1457,stroke-width:2px,color:#fff
    classDef analysis fill:#00BCD4,stroke:#006064,stroke-width:2px,color:#fff
    classDef documentation fill:#FFC107,stroke:#F57F17,stroke-width:2px,color:#000
    
    class Start,End startEnd
    class B,B1,B2,B3,B3a,B3b,B3c preparation
    class C,C1,C1a,C1b,C1c,C2,C2a,C2b,C2c,C3,C3a,C3b,C3c,D,D1,D2,D3,D4,D5,E dataCollection
    class G,G1,G2,G3,G4,G5,G6,H,I,I1,J,J1,J2,J3 modeling
    class K,K1,K2,K3,K4,L,L1,L2,L3,L4 system
    class M,M1,M2,M3,M4,N,N1,N2,N3,N4 analysis
    class O,O1,O2,O3,O4,P,P1,P2,P3 documentation
                    </pre>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Sistem Monitoring Real-Time Pendaki Gunung Gede Pangrango</strong></p>
            <p>Penelitian berbasis Time Geography dan Bayesian Uncertainty Quantification</p>
            <p style="margin-top: 15px;">
                üìß Kontak: <a href="mailto:your.email@example.com">your.email@example.com</a> | 
                üîó GitHub: <a href="https://github.com/yourusername" target="_blank">@yourusername</a>
            </p>
        </div>
    </div>

    <script>
        // Initialize Mermaid with callback
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        let panzoomInstance;
        let initialized = false;
        
        // Function to initialize panzoom after mermaid renders
        async function initializePanzoom() {
            if (initialized) return;
            
            try {
                // Render mermaid first
                const flowchartDiv = document.querySelector('#flowchart .mermaid');
                if (!flowchartDiv) {
                    console.log('Mermaid element not found, retrying...');
                    setTimeout(initializePanzoom, 500);
                    return;
                }
                
                // Render the diagram
                const { svg } = await mermaid.render('mermaid-diagram', flowchartDiv.textContent);
                flowchartDiv.innerHTML = svg;
                
                console.log('Mermaid rendered successfully');
                document.querySelector('.loading').style.display = 'none';
                
                // Wait a bit for DOM update
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // Get the SVG element
                const svgElement = document.querySelector('#flowchart svg');
                
                if (!svgElement) {
                    console.error('SVG not found after rendering');
                    return;
                }
                
                console.log('Initializing panzoom on SVG...');
                
                // Make SVG fill the space properly
                svgElement.style.maxWidth = 'none';
                svgElement.style.height = 'auto';
                
                // Initialize panzoom on the wrapper to pan the SVG
                const wrapper = document.getElementById('flowchart');
                
                panzoomInstance = panzoom(wrapper, {
                    maxZoom: 5,
                    minZoom: 0.1,
                    bounds: false,
                    boundsPadding: 1,
                    zoomDoubleClickSpeed: 1,
                    smoothScroll: true,
                    zoomSpeed: 0.065,
                    autocenter: true,
                    beforeWheel: function(e) {
                        // Allow wheel zoom
                        return true;
                    }
                });

                initialized = true;
                console.log('Panzoom initialized successfully');
                
                // Fit to screen after a delay
                setTimeout(() => {
                    fitToScreen();
                }, 500);
                
            } catch (error) {
                console.error('Error initializing:', error);
                setTimeout(initializePanzoom, 1000);
            }
        }

        function fitToScreen() {
            if (!panzoomInstance) {
                console.log('Panzoom not ready');
                return;
            }
            
            try {
                const container = document.getElementById('flowchart-wrapper');
                const svgElement = document.querySelector('#flowchart svg');
                
                if (!svgElement) {
                    console.log('SVG not found for fitting');
                    return;
                }
                
                // Reset first
                panzoomInstance.moveTo(0, 0);
                panzoomInstance.zoomAbs(0, 0, 1);
                
                // Get dimensions
                const containerRect = container.getBoundingClientRect();
                const svgRect = svgElement.getBBox();
                
                // Calculate scale
                const padding = 50;
                const scaleX = (containerRect.width - padding * 2) / svgRect.width;
                const scaleY = (containerRect.height - padding * 2) / svgRect.height;
                const scale = Math.min(scaleX, scaleY, 0.8);
                
                console.log('Fitting with scale:', scale);
                
                // Apply scale centered
                setTimeout(() => {
                    const centerX = containerRect.width / 2;
                    const centerY = containerRect.height / 2;
                    
                    panzoomInstance.zoomAbs(centerX, centerY, scale);
                    
                    // Center the content
                    const transform = panzoomInstance.getTransform();
                    const offsetX = (containerRect.width - svgRect.width * scale) / 2;
                    const offsetY = (containerRect.height - svgRect.height * scale) / 2;
                    
                    panzoomInstance.moveTo(offsetX, offsetY);
                }, 100);
                
            } catch (error) {
                console.error('Error fitting to screen:', error);
            }
        }

        function zoomIn() {
            if (!panzoomInstance) return;
            try {
                const container = document.getElementById('flowchart-wrapper');
                const rect = container.getBoundingClientRect();
                panzoomInstance.smoothZoom(rect.width / 2, rect.height / 2, 1.4);
            } catch (error) {
                console.error('Error zooming in:', error);
            }
        }

        function zoomOut() {
            if (!panzoomInstance) return;
            try {
                const container = document.getElementById('flowchart-wrapper');
                const rect = container.getBoundingClientRect();
                panzoomInstance.smoothZoom(rect.width / 2, rect.height / 2, 0.7);
            } catch (error) {
                console.error('Error zooming out:', error);
            }
        }

        function resetZoom() {
            setTimeout(fitToScreen, 100);
        }

        function toggleFullscreen() {
            const container = document.getElementById('chart-container');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Handle fullscreen change
        document.addEventListener('fullscreenchange', () => {
            const btn = document.querySelector('.btn-fullscreen');
            if (document.fullscreenElement) {
                btn.innerHTML = '‚õ∂ Exit Fullscreen';
                setTimeout(fitToScreen, 500);
            } else {
                btn.innerHTML = '‚õ∂ Fullscreen';
                setTimeout(fitToScreen, 500);
            }
        });
        
        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (panzoomInstance) fitToScreen();
            }, 300);
        });

        // Start initialization
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, starting initialization...');
            setTimeout(initializePanzoom, 500);
        });
        
        // Fallback for already loaded
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            console.log('Document already loaded, starting initialization...');
            setTimeout(initializePanzoom, 500);
        }
    </script>
</body>
</html>
